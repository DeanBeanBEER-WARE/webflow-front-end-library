class ComboClassConfigurator{constructor(t){if(!Array.isArray(t))throw Error("Invalid classConfigs parameter. An array is expected.");this.initialConfigs=t,this.classConfigs=[],this.scrollObservers=new Map,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){const t=["ease","ease-in","ease-out","ease-in-out"],s={eventName:"click",transitionTime:"0s",removeTransitionTime:null,easingMode:"ease",entryThreshold:0,exitThreshold:null,parentElement:"",triggerElement:"",once:!1,debounce:0,switchAction:!1,repeatConfiguration:1,triggerAttribut:"",parentAttribute:"",callback:null,classesAdded:!1,start:1,end:0,frequency:1,addClasses:[],removeClasses:[],topAddClasses:[]};this.initialConfigs.forEach(e=>{const n={...s,...e};n.easingMode=t.includes(n.easingMode)?n.easingMode:s.easingMode,n.entryThreshold=this._validateThreshold(n.entryThreshold,s.entryThreshold),n.exitThreshold=this._validateThreshold(n.exitThreshold,s.exitThreshold),n.addClasses=this._cleanClasses(n.addClasses),n.removeClasses=this._cleanClasses(n.removeClasses),n.topAddClasses=this._cleanClasses(n.topAddClasses);const i="number"==typeof n.repeatConfiguration&&n.repeatConfiguration>=1?Math.floor(n.repeatConfiguration):1;n.topAddClasses.length>0&&(n.removeClasses.length>0&&(console.warn("'removeClasses' should not be defined when 'topAddClasses' is set. It will be ignored."),n.removeClasses=[]),n.switchAction&&(console.warn("'switchAction' should not be defined when 'topAddClasses' is set. It will be set to false."),n.switchAction=!1)),n.triggerAttribut&&n.parentAttribute?this._processAttributeBasedPairing(n):this._processRepeatConfiguration(n,i)}),this.initEventListeners()}_validateThreshold(t,s){return"number"==typeof t&&t>=0&&t<=100?t:s}_cleanClasses(t){return Array.isArray(t)?t.map(t=>t.replace(".","").trim()).filter(Boolean):[]}_processAttributeBasedPairing(t){const s=document.querySelectorAll(`[${t.parentAttribute}]`),e=document.querySelectorAll(`[${t.triggerAttribut}]`),n=this._mapElementsByAttribute(s,t.parentAttribute),i=this._mapElementsByAttribute(e,t.triggerAttribut);n.forEach((s,e)=>{i.has(e)&&i.get(e).forEach(n=>{s.forEach(s=>{this.classConfigs.push({...t,parentElement:s,triggerElement:n,repeatConfiguration:1,triggerAttribut:"",parentAttribute:""})})})})}_mapElementsByAttribute(t,s){const e=new Map;return t.forEach(t=>{const n=t.getAttribute(s).trim();n&&(e.has(n)?e.get(n).push(t):e.set(n,[t]))}),e}_processRepeatConfiguration(t,s){for(let e=1;e<=s;e++){const s=1===e?":`-${e}`,n=t=>t?t.endsWith(s)?t:`${t}${s}`:"",i=n(t.parentElement),r=n(t.triggerElement);this.classConfigs.push({...t,parentElement:i,triggerElement:r,repeatConfiguration:1})}}initEventListeners(){const t=(t,s=0)=>{let e=null,n=null,i=null;const r=()=>{e=null,t(...i),i=null};return function(...l){i=l,null===e&&(e=requestAnimationFrame(r)),s>0&&(clearTimeout(n),n=setTimeout(()=>{null!==e&&(cancelAnimationFrame(e),e=null),t(...i),i=null},s))}},s=new Map([["click",this._handleClick.bind(this)],["hover",this._handleHover.bind(this)],["scrollInView",this._handleScrollInView.bind(this)]]);this.classConfigs.forEach(e=>{const{eventName:n,entryThreshold:i,exitThreshold:r,debounce:l,once:a,switchAction:o,topAddClasses:c}=e;let h=null;if(e.triggerElement&&(h=e.triggerElement instanceof Element?e.triggerElement:getElement(e.triggerElement)),e.triggerElement&&!h)return;const d=t(()=>{(!e.once||!e.classesAdded)&&(this._initClasses(e,"add"),e.classesAdded=!0,e.callback&&e.callback(h||null,"add"))},l),u=t(()=>{a||(this._initClasses(e,"remove"),e.classesAdded=!1,e.callback&&e.callback(h||null,"remove"))},l),g=s.get(n);g?g(h,e,d,u,this._calculateThresholds(i,r)):this._applyImmediateClasses(e)})}_calculateThresholds(t,s){const e=new Set;return e.add(t/100),null!==s&&e.add(s/100),Array.from(e)}_initClasses(t,s){const{targetClass:e,addClasses:n,removeClasses:i,topAddClasses:r,frequency:l,start:a,end:o,transitionTime:c,removeTransitionTime:h,easingMode:d}=t,u="remove"===s&&h?h:c,g=t.parentElement?"string"==typeof t.parentElement?getElement(t.parentElement)||document:t.parentElement:document,m=g.querySelectorAll(e),f=a-1,p=0===o?1/0:o-1;m.forEach((e,a)=>{a>=f&&a<=p&&(a-f)%l==0&&(e.style.transition=`all ${u} ${d}`,requestAnimationFrame(()=>{"remove"===s?r.length>0?e.classList.remove(...r,...n):e.classList.remove(...i):r.length>0?e.getBoundingClientRect().bottom<0?(e.classList.add(...r),e.classList.remove(...n)):e.getBoundingClientRect().top>(window.innerHeight||document.documentElement.clientHeight)&&(e.classList.add(...n),e.classList.remove(...r)):e.classList.add(...n),t.callback&&t.callback(e,s)}))})}_handleClick(t,s,e,n){t.addEventListener("click",()=>{const i=s.classesAdded?"remove":"add";"add"===i?e():n(),s.classesAdded=!s.classesAdded,s.callback&&s.callback(t,i)})}_handleHover(t,s,e,n){s.switchAction?(t.addEventListener("mouseenter",n),t.addEventListener("mouseleave",e)):(t.addEventListener("mouseenter",e),t.addEventListener("mouseleave",n))}_handleScrollInView(t,s,e,n,i){const r=JSON.stringify({threshold:i.sort(),root:null,rootMargin:"0px"});let l=this.scrollObservers.get(r);l||(l=new IntersectionObserver(t=>{t.forEach(t=>{const s=t.target,e=s.__comboClassConfigs||[];e.forEach(e=>{const{switchAction:n,entryThreshold:i,exitThreshold:r,debouncedInit:l,debouncedRemove:a,topAddClasses:o}=e,c=t.intersectionRatio;if(o.length>0){const t=s.getBoundingClientRect();t.bottom<0?l():t.top>(window.innerHeight||document.documentElement.clientHeight)&&a()}else n?(c>=i/100&&a(),null!==r&&c<r/100&&l()):(c>=i/100&&l(),null!==r&&c<r/100&&a())})})},{threshold:i}),this.scrollObservers.set(r,l)),t.__comboClassConfigs||(t.__comboClassConfigs=[],l.observe(t)),t.__comboClassConfigs.push({...s,debouncedInit:e,debouncedRemove:n}),s.once&&(s.callback=s.callback?(t,e)=>{s.callback(t,e),"remove"===e&&(l.unobserve(t),t.__comboClassConfigs.splice(t.__comboClassConfigs.indexOf(s),1))}:null)}_applyImmediateClasses(t){t.topAddClasses.length>0?(this._initClasses(t,"add"),t.classesAdded=!0):t.addClasses.length>0&&(this._initClasses(t,"add"),t.classesAdded=!0),t.removeClasses.length>0&&(this._initClasses(t,"remove"),t.classesAdded=!1)}}function getElement(t){return t?t.startsWith(".")?document.querySelector(t):document.getElementById(t):null}window.ComboClassConfigurator=ComboClassConfigurator;
